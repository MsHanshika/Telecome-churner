<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Telecom Churn Demo</title>
    <link rel="stylesheet" href="style.css" />
</head>

<body>
<div class="container">
    <h1>üìä Telecom Churn Prediction</h1>
    <p class="subtitle">Predict customer churn probability</p>

    <form id="predict-form">
        <div class="form-group">
            <label>Gender</label>
            <select name="gender">
                <option value="Male">Male</option>
                <option value="Female">Female</option>
            </select>
        </div>

        <div class="form-group">
            <label>Senior Citizen</label>
            <select name="SeniorCitizen">
                <option value="0">No</option>
                <option value="1">Yes</option>
            </select>
        </div>

        <div class="form-group">
            <label>Partner</label>
            <select name="Partner">
                <option value="No">No</option>
                <option value="Yes">Yes</option>
            </select>
        </div>

        <div class="form-group">
            <label>Dependents</label>
            <select name="Dependents">
                <option value="No">No</option>
                <option value="Yes">Yes</option>
            </select>
        </div>

        <div class="form-group">
            <label>Tenure (months)</label>
            <input type="number" name="tenure" value="12" min="0" required/>
        </div>

        <div class="form-group">
            <label>Monthly Charges ($)</label>
            <input type="number" name="MonthlyCharges" value="70" step="0.01" min="0" required/>
        </div>

        <div class="form-group">
            <label>Total Charges ($)</label>
            <input type="number" name="TotalCharges" value="840" step="0.01" min="0" required/>
        </div>

        <div class="form-group">
            <label>Phone Service</label>
            <select name="PhoneService">
                <option value="Yes">Yes</option>
                <option value="No">No</option>
            </select>
        </div>

        <div class="form-group">
            <label>Internet Service</label>
            <select name="InternetService">
                <option value="Fiber optic">Fiber optic</option>
                <option value="DSL">DSL</option>
                <option value="No">No</option>
            </select>
        </div>

        <div class="form-group">
            <label>Contract</label>
            <select name="Contract">
                <option value="Month-to-month">Month-to-month</option>
                <option value="One year">One year</option>
                <option value="Two year">Two year</option>
            </select>
        </div>

        <button type="submit">üîÆ Predict Churn</button>
    </form>

    <div id="result"></div>
</div>

<script>
const form = document.getElementById('predict-form');
const resultDiv = document.getElementById('result');
const submitBtn = form.querySelector('button'); // Get the button

form.addEventListener('submit', async e => {
    e.preventDefault();

    // 1. UI FEEDBACK: Disable button & show loading state immediately
    const originalBtnText = submitBtn.innerHTML;
    submitBtn.disabled = true;
    submitBtn.innerHTML = '‚è≥ Predicting...';
    
    // Show spinner in the result area
    resultDiv.style.display = 'block';
    resultDiv.className = ''; // Reset class
    resultDiv.innerHTML = `
        <div class="loader"></div>
        <div class="loading-text">Analyzing customer data...</div>
    `;

    try {
        const formData = new FormData(form);
        const data = {};
        
        formData.forEach((value, key) => {
            if (['tenure', 'MonthlyCharges', 'TotalCharges', 'SeniorCitizen'].includes(key)) {
                data[key] = parseFloat(value);
            } else {
                data[key] = value;
            }
        });

        // REPLACE WITH YOUR RENDER URL
        const resp = await fetch('https://your-app-name.onrender.com/predict', { 
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });

        if (!resp.ok) {
            const errorText = await resp.text();
            throw new Error(`HTTP ${resp.status}: ${errorText}`);
        }

        const result = await resp.json();
        
        // 2. DISPLAY RESULT (Overwrites the spinner)
        const prob = (result.churn_probability * 100).toFixed(1);
        const risk = result.risk_level || (prob >= 70 ? 'High' : prob >= 40 ? 'Medium' : 'Low');
        
        resultDiv.className = `result-${risk.toLowerCase()} show`;
        const emoji = risk === 'High' ? '‚ö†Ô∏è' : risk === 'Medium' ? '‚ö°' : '‚úÖ';
        
        resultDiv.innerHTML = `
            <div class="result-label">${emoji} ${risk} Risk</div>
            <div class="result-prob">${prob}%</div>
            <div>Churn Probability</div>
        `;
        
    } catch (err) {
        console.error(err);
        resultDiv.className = 'result-high show';
        resultDiv.innerHTML = `
            <div class="result-label">‚ùå Error</div>
            <div>${err.message}</div>
        `;
    } finally {
        // 3. CLEANUP: Always re-enable the button when done
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalBtnText;
        form.classList.remove('loading');
    }
});
</script>

</body>
</html>
</html>